function initHeaderMenu(){const mobileBtn=document.getElementById('mobileBtn');const mobileMenu=document.getElementById('mobileMenu');const searchBtn=document.getElementById('searchBtn');const searchDropdown=document.getElementById('searchDropdown');const languageBtn=document.getElementById('languageBtn');const languageDropdown=document.getElementById('languageDropdown');const mobilePillarsMenu=document.getElementById('mobilePillarsMenu');const mobilePillarsBtn=document.getElementById('mobilePillarsBtn');const pillarsArrow=document.getElementById('pillarsArrow');const syncBodyScrollLock=()=>{try{const shouldLock=mobileMenu&&mobileMenu.classList.contains('open');document.body.classList.toggle('menu-open',Boolean(shouldLock))}catch(err){}};if(!mobileBtn||!searchBtn||!languageBtn){console.warn("Header elements not ready");return}
mobileBtn.onclick=(e)=>{e.stopPropagation();mobileMenu.classList.toggle('open');searchDropdown.classList.remove('open');languageDropdown.classList.remove('open');if(mobilePillarsMenu){mobilePillarsMenu.classList.add('hidden')}
if(pillarsArrow)pillarsArrow.style.transform='';syncBodyScrollLock()};searchBtn.onclick=(e)=>{e.stopPropagation();searchDropdown.classList.toggle('open');languageDropdown.classList.remove('open');mobileMenu.classList.remove('open');if(mobilePillarsMenu){mobilePillarsMenu.classList.add('hidden')}
if(pillarsArrow)pillarsArrow.style.transform='';syncBodyScrollLock()};languageBtn.onclick=(e)=>{e.stopPropagation();languageDropdown.classList.toggle('open');searchDropdown.classList.remove('open');mobileMenu.classList.remove('open');if(mobilePillarsMenu){mobilePillarsMenu.classList.add('hidden')}
if(pillarsArrow)pillarsArrow.style.transform='';syncBodyScrollLock();if(languageDropdown.classList.contains('open')){showAllLanguages(!0)}};document.addEventListener('click',(e)=>{if(!mobileMenu.contains(e.target)){mobileMenu.classList.remove('open');syncBodyScrollLock()}
if(!searchDropdown.contains(e.target))searchDropdown.classList.remove('open');if(!languageDropdown.contains(e.target))languageDropdown.classList.remove('open');try{if(mobilePillarsMenu&&!mobilePillarsMenu.contains(e.target)&&!(mobilePillarsBtn&&mobilePillarsBtn.contains(e.target))){mobilePillarsMenu.classList.add('hidden');if(pillarsArrow)pillarsArrow.style.transform=''}}catch(err){}});let lastScrollTop=0;window.addEventListener('scroll',()=>{const currentScroll=window.pageYOffset||document.documentElement.scrollTop;if(currentScroll!==lastScrollTop&&mobileMenu.classList.contains('open')){mobileMenu.classList.remove('open');syncBodyScrollLock()}
lastScrollTop=currentScroll<=0?0:currentScroll},!1);ensureLanguageOptions();populateDesktopLanguageList();populateMobileLanguageList();if(typeof initSearch==='function'){initSearch()}else{window.addEventListener('load',()=>{if(typeof initSearch==='function'){initSearch()}})}}
if(document.readyState==='loading'){document.addEventListener('DOMContentLoaded',initHeaderMenu)}else{initHeaderMenu()}
function ensureLanguageOptions(){const desktopSelect=document.getElementById('desktopLanguageSelect');const mobileSelect=document.getElementById('mobileLanguageSelect');const options=[{value:'en',label:'English'},{value:'af',label:'Afrikaans'},{value:'sq',label:'Shqip'},{value:'am',label:'አማርኛ'},{value:'ar',label:'العربية'},{value:'hy',label:'Հայերեն'},{value:'az',label:'Azərbaycanca'},{value:'eu',label:'Euskara'},{value:'be',label:'Беларусь'},{value:'bn',label:'বাংলা'},{value:'bs',label:'Bosanski'},{value:'bg',label:'Български'},{value:'ca',label:'Català'},{value:'ceb',label:'Cebuano'},{value:'ny',label:'Chichewa'},{value:'zh-CN',label:'中文 (简体)'},{value:'zh-TW',label:'中文 (繁體)'},{value:'co',label:'Corsu'},{value:'hr',label:'Hrvatski'},{value:'cs',label:'Čeština'},{value:'da',label:'Dansk'},{value:'nl',label:'Nederlands'},{value:'eo',label:'Esperanto'},{value:'et',label:'Eesti'},{value:'tl',label:'Filipino'},{value:'fi',label:'Suomi'},{value:'fr',label:'Français'},{value:'fy',label:'Frisian'},{value:'gl',label:'Galego'},{value:'ka',label:'ქართული'},{value:'de',label:'Deutsch'},{value:'el',label:'Ελληνικά'},{value:'gu',label:'ગુજરાતી'},{value:'ht',label:'Kreyòl Ayisyen'},{value:'ha',label:'Hausa'},{value:'haw',label:'Hawaiki'},{value:'hi',label:'हिन्दी'},{value:'hu',label:'Magyar'},{value:'is',label:'Íslenska'},{value:'ig',label:'Igbo'},{value:'id',label:'Bahasa Indonesia'},{value:'ga',label:'Gaeilge'},{value:'it',label:'Italiano'},{value:'ja',label:'日本語'},{value:'jw',label:'Basa Jawa'},{value:'kk',label:'Қазақ'},{value:'km',label:'ខ្មែរ'},{value:'rw',label:'Kinyarwanda'},{value:'ko',label:'한국어'},{value:'ku',label:'کوردی'},{value:'ky',label:'Кыргызча'},{value:'lo',label:'ລາວ'},{value:'la',label:'Latina'},{value:'lv',label:'Latviešu'},{value:'lt',label:'Lietuvių'},{value:'lb',label:'Lëtzebuergesch'},{value:'mk',label:'Македонски'},{value:'mg',label:'Malagasy'},{value:'ms',label:'Bahasa Melayu'},{value:'ml',label:'മലയാളം'},{value:'mt',label:'Maltese'},{value:'mi',label:'Māori'},{value:'mr',label:'मराठी'},{value:'mn',label:'Монгол'},{value:'my',label:'မြန်မာ'},{value:'ne',label:'नेपाली'},{value:'no',label:'Norsk'},{value:'or',label:'ଓଡିଆ'},{value:'ps',label:'پښتو'},{value:'fa',label:'فارسی'},{value:'pl',label:'Polski'},{value:'pt',label:'Português'},{value:'pt-BR',label:'Português (Brasil)'},{value:'pa',label:'ਪੰਜਾਬੀ'},{value:'ro',label:'Română'},{value:'ru',label:'Русский'},{value:'sm',label:'Samoan'},{value:'gd',label:'Gàidhlig'},{value:'sr',label:'Српски'},{value:'st',label:'Sesotho'},{value:'sn',label:'Shona'},{value:'sd',label:'سنڌي'},{value:'si',label:'සිංහල'},{value:'sk',label:'Slovenčina'},{value:'sl',label:'Slovenščina'},{value:'so',label:'Somali'},{value:'es',label:'Español'},{value:'su',label:'Sundanese'},{value:'sw',label:'Swahili'},{value:'sv',label:'Svenska'},{value:'tg',label:'Тоҷикӣ'},{value:'ta',label:'தமிழ்'},{value:'te',label:'తెలుగు'},{value:'th',label:'ไทย'},{value:'tr',label:'Türkçe'},{value:'tk',label:'Түркмөнче'},{value:'uk',label:'Українська'},{value:'ur',label:'اردو'},{value:'ug',label:'ئۇيغۇرچە'},{value:'uz',label:"O'zbek"},{value:'vi',label:'Tiếng Việt'},{value:'cy',label:'Cymraeg'},{value:'xh',label:'Xhosa'},{value:'yi',label:'יידיש'},{value:'yo',label:'Yorùbá'},{value:'zu',label:'Zulu'}];const fill=(select)=>{if(!select)return;if(select.options.length>1)return;options.forEach(opt=>{const option=document.createElement('option');option.value=opt.value;option.textContent=opt.label;select.appendChild(option)})};fill(desktopSelect);fill(mobileSelect)}
function toggleMobilePillars(event){try{if(event&&event.stopPropagation)event.stopPropagation();}catch(e){}
const menu=document.getElementById('mobilePillarsMenu');const arrow=document.getElementById('pillarsArrow');if(!menu)return;const wasHidden=menu.classList.contains('hidden');if(wasHidden){menu.classList.remove('hidden');if(arrow)arrow.style.transform='rotate(180deg)'}else{menu.classList.add('hidden');if(arrow)arrow.style.transform=''}}
function googleTranslate(lang){if(!lang)return;const normalize=(s)=>(s||'').toString();const tryApply=()=>{const select=document.querySelector('.goog-te-combo');if(!select)return!1;const candidates=[lang,lang.replace('-','_'),lang.split('-')[0]];let matchedIndex=-1;for(let i=0;i<select.options.length;i++){const optVal=normalize(select.options[i].value).toLowerCase();if(candidates.some(c=>c&&optVal===normalize(c).toLowerCase())){matchedIndex=i;break}}
try{if(matchedIndex>=0){select.selectedIndex=matchedIndex}else{select.value=lang}
const ev=new Event('change',{bubbles:!0});select.dispatchEvent(ev);if(typeof select.onchange==='function')select.onchange(ev);return!0}catch(e){return!1}};const interval=setInterval(()=>{const ok=tryApply();if(ok)clearInterval(interval);},300);setTimeout(()=>{const ok=tryApply();clearInterval(interval);if(!ok){try{const cookieVal=`/en/${lang}`;document.cookie=`googtrans=${encodeURIComponent(cookieVal)}; path=/;`;try{document.cookie=`googtrans=${encodeURIComponent(cookieVal)}; path=/; domain=${location.hostname};`}catch(e){}}catch(e){}
console.warn('googleTranslate: falling back to cookie method for',lang);window.location.reload()}},8000)}
function showAllLanguages(forceShow=!1){const container=document.getElementById('allLangContainer');if(!container)return;if(!forceShow&&!container.classList.contains('hidden')){container.classList.add('hidden');return}
const waitInterval=setInterval(()=>{const select=document.querySelector('.goog-te-combo');if(select){clearInterval(waitInterval);if(document.getElementById('allLangSelect')){container.classList.remove('hidden');return}
const clone=select.cloneNode(!0);clone.id='allLangSelect';clone.classList.add('w-full','border','rounded','px-2','py-2','mt-2');clone.addEventListener('change',function(){const val=this.value;googleTranslate(val)});container.appendChild(clone);container.classList.remove('hidden')}},300)}
function populateDesktopLanguageList(){const select=document.getElementById('desktopLanguageSelect');const listContainer=document.getElementById('desktopLanguageList');if(!select||!listContainer)return;Array.from(select.options).forEach(option=>{if(option.value){const btn=document.createElement('button');btn.type='button';btn.className='w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 text-sm border-b dark:border-gray-700 transition-colors';btn.textContent=option.text;btn.onclick=(e)=>{e.preventDefault();googleTranslate(option.value);document.getElementById('languageDropdown').classList.remove('open')};listContainer.appendChild(btn)}})}
function populateMobileLanguageList(){const select=document.getElementById('mobileLanguageSelect');const listContainer=document.getElementById('mobileLanguageList');const toggleBtn=document.getElementById('mobileLanguageToggle');if(!select||!listContainer||!toggleBtn)return;Array.from(select.options).forEach(option=>{if(option.value){const btn=document.createElement('button');btn.type='button';btn.className='w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 text-sm border-b border-gray-900 dark:border-gray-700 transition-colors text-blue-900 dark:text-gray-300';btn.textContent=option.text;btn.onclick=(e)=>{e.preventDefault();googleTranslate(option.value);listContainer.classList.add('hidden')};listContainer.appendChild(btn)}});toggleBtn.addEventListener('click',(e)=>{e.preventDefault();listContainer.classList.toggle('hidden')});document.addEventListener('click',(e)=>{if(!toggleBtn.contains(e.target)&&!listContainer.contains(e.target)){listContainer.classList.add('hidden')}})}